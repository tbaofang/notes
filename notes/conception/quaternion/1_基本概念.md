
四元数的指数对数运算


四元数的诞生:
1. 解决向量乘法,向量之间的乘法有内积和外积,这两个运算均不满足群的条件(??)
2. 将三维空间无法解决的问题映射到四维空间.

四元数相比其他形式的优点：
1. 解决万向节死锁（Gimbal Lock）问题
2. 仅需存储4个浮点数，相比矩阵更加轻量
3. 四元数无论是求逆、**串联**等操作，相比矩阵更加高效


是主流游戏或动画引擎都会以缩放向量+旋转四元数+平移向量的形式进行存储角色的运动数据.

---

几个概念:
1. **空间中的子空间：** 一般而言，空间（维度>2）都存在更低维的子空间.
2. **空间和子空间的映射：** 我们将二维空间表示为(x,y)，当y=0时，其实可以看成是一维的，只不过它表示成(x,0)这种形式。推到四维，(w,x,y,z)，当w=0时，(0,x,y,z)就是一个三维子空间，这也是为什么我们可以用单位四元数对三维向量进行操作，其实我们是将 **三维向量映射到四维的三维子空间**（w=0，这种形式也成纯四元数），然后对其进行旋转，最终得到的向量结果依然是这个三维子空间中的，因而可以映射回三维空间。
3. **广义球：** 这里的球是广义上的。我们在二维平面上，广义球其实指代circle，三维空间上就是我们认知上的球，称为**two-sphere**，而四维空间中广义球其实是一个超球（hyper-sphere），又称为**three-sphere** 。单位向量其实就是广义球上面的点，而单位四元数也就是three-sphere上面的点。
4. **约束与特征向量：** 空间中的一点由x, y, z等参数来表示，一般来说参数的数量与维数相等，二维空间的点用{x, y}参数，四维空间的点用{x, y, z, w}参数。但是对于空间的点加以约束，则该会减少参数的数量，比如三维空间的点在某一单位球面上，原本三个参数{x, y, z}才能表达的点现在只需要两个参数{u, v}就可以表达。如果{u, v}是单位向量，也可以称{u, v}是{x, y, z}的特征向量。

---

复数

1. 让-1的平方根变得意义
2. 将原本一维的数值范围直接加了一个维度,从极坐标的角度去思考复数，x+i·y可以写成r·cosθ+i·r·sinθ，我们只考虑单位复数，|r|=1，也就得到cosθ+i·sinθ

欧拉公式，基本上复数的所有运算递推都会用到这个公式.

$$
\begin{aligned}
  z = x +iy  = r\cos\theta + i r \sin\theta = r e^{i\theta}
\end{aligned} 
$$

从复数推导出四元数:

$$
\begin{aligned}
e^{i \cdot \hat{n} \theta / 2} &= \cos(\theta / 2) + i \cdot \hat{n} \sin (\theta / 2) \\
&=   q_0 + i \cdot q \\
&= q_0 + i q_1 + j q_2 + k q_3
\end{aligned}
$$

其中,n为三维单位向量, $i^2 = j^2 = k^2 = i \cdot j \cdot \cdot k = -1$.

随着维度的提高，特性会逐步牺牲，相比复数运算，四元数牺牲了交换律；相比四元数运算，八元数牺牲了结合律。

problem:
1. $\cos\theta + i \sin \theta = r e^{i\theta}$ 定义??
2. 单位复数乘法可以达到一个二维旋转的效果 ??

---

四元数特性:

- 四元数（以后不特指**四元数=单位四元数**）是四维空间中一个超球上面的点，满足w²+x²+y²+z²=1；而纯四元数是四维空间在w=0时的一个子空间的点，形式为{0, q}，特别注意的是纯四元数与四元数是不同的概念。
- 四元数是**复数虚部扩展**的结果，复数的虚部为1个，而四元数虚部有3个，且两两互相正交，其中实部是cosθ/2，而虚部为一个单位轴乘以sinθ/2。
- 四元数自由度并没有四个维度，由于存在w²+x²+y²+z²=1这个约束，它的自由度其实只有3，且每个四元数可以对应一个特征向量，即n。但请记住**四元数并不是与特征向量**一一对应的，后文会有说。

---

四元数的乘法:

$$
\begin{aligned}
  pq &= [p_0, p_1, p_2, p_3]^T [q_0, q_1, q_2, q_3]^T \\
  &= \begin{bmatrix}
    p_0 q_0 - p_1 q_1 - p_2 q_2 - p_3 q_3 \\
    p_1 q_0 + p_0 q_1 + p_2 q_3 - p_3 q_2 \\
    p_2 q_0 + p_0 q_2 + p_3 q_1 - p_1 q_3 \\
    p_3 q_0 + p_0 q_3 + p_1 q_2 - p_2 q_1 
  \end{bmatrix} \\
  &= [p_0 q_0 - \vec{p} \vec{q}, p_0 \vec{q} + q_0 \vec{p} +\vec{p} \times \vec{q}]^T
\end{aligned}
$$

其中,$p^\land = \begin{bmatrix}
  0 & -p_3 & p_2 \\
  p_3 & 0 & -p_1 \\
  -p_2 & p_1 & 0
\end{bmatrix}$


